var klad={};klad.createImages=function(){"use strict";var A={},e="data:image/png;base64,";return A.brick=new Image,A.brick.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAP0lEQVR4nI2PQQ4AMAjCCv//s7vMTM2WzFsJoIogyBEUAoFREWKbCruJGiaBWzJOMtmv3cm+1VbW/xezad+yAMFVFBCr4YpwAAAAAElFTkSuQmCC",A.brick0=new Image,A.brick0.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAN0lEQVR4nGNkYGD4z/CfAQIYGRjgbCifCS7BAJVkZEAB6HowABM+SWor+I9E/0dXAHM9si+gigBnLQsKRH01wAAAAABJRU5ErkJggg==",A.brick1=new Image,A.brick1.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAPElEQVR4nH2OQRIAIAgCV///Z7ropFlxYQRkMIRIGJQLrEq6hxz6BwoeDQ/4z9yB7DgZ8CbaDHkd1AYGFsyuEAgTSqzIAAAAAElFTkSuQmCC",A.brick2=new Image,A.brick2.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAPElEQVR4nG2OMQ4AMAgCT///Z7poIloWIgEhEKIRMC6IKelvyp1AxfZBN9mmLR+k9W+2DbtGbRiDbGDhAUUDFAVfYjIvAAAAAElFTkSuQmCC",A.brickEX=new Image,A.brickEX.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJUlEQVR4nGP4z8Dw/z8Dw/+nT5/+x8ZmYiAE0HWgY+JMGGA3AAByU0npT9OE8wAAAABJRU5ErkJggg==",A.brickL0=new Image,A.brickL0.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAQElEQVR4nG3OyREAIAgDwMT+e44POTIgH651hAAE4QWBqqM/tUAsaUAJEnEgOvBQ4z+wWzYY3zTQJ9cN2i9zfgHqFBAPar/2rwAAAABJRU5ErkJggg==",A.brickL1=new Image,A.brickL1.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANklEQVR4nH2PyQ0AMAjDnIr9V6bftBz5ITlWEJB4/BIc/uiFK+BQa3BoNNiW3QDE1Ow3JOWLCwQsCBIf3RD4AAAAAElFTkSuQmCC",A.brickR0=new Image,A.brickR0.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAQElEQVR4nHWOQQ4AIAjDOv7/ZzwocWDkQhjdQCRJlcAmEAQyIQ/E7fGIPgPRnB7fgM9yAzNWEyinn0kHfg8eaAFWpBARayArAQAAAABJRU5ErkJggg==",A.brickR1=new Image,A.brickR1.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOklEQVR4nI2PQQoAIAgER+n/X7ZDJotRNCAijgsaQbAxILInrkNJwugXHb+vvoVH/BICqpB+JOiLIk3RVgoRGPsmzwAAAABJRU5ErkJggg==",A.bullet=new Image,A.bullet.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAF0lEQVR4nGNgGGTgPwPD//8MDP/pbC0AzUkD/SMEoXgAAAAASUVORK5CYII=",A.door=new Image,A.door.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAIklEQVR4nGNkYGD4z8DwnwEBGBmQARM2QSwK/hNSMLhNAACE4gUQC23uNwAAAABJRU5ErkJggg==",A.key=new Image,A.key.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAO0lEQVR4nH2PQQ4AIAjDOuL/v4wnzSAoF8hYRxCQfGp1wd0CYqJkczFk6+XEEZ2+Ca8lQHjc9E44OSVsW30IEqxB5CQAAAAASUVORK5CYII=",A.klad=new Image,A.klad.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAKklEQVR4nGNkYGD4z4AHMOGTpI4CFgY8jmCE4v/4VDAyMDD8x2cCQTcAAMHgBg3SI4B+AAAAAElFTkSuQmCC",A.lestnica=new Image,A.lestnica.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAALUlEQVR4nGNkYGD4/58BAhihNDKf8T+CjxUwMSJxGJFMgfGZ8OlmIEYBHdwAAIxTBxFVyi5jAAAAAElFTkSuQmCC",A.most=new Image,A.most.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJElEQVR4nGNkYGD4z4AHsOCVZWBgYGKEMvDReA1hImADPRQAAJXoAxI2rD0rAAAAAElFTkSuQmCC",A.opendoor=new Image,A.opendoor.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAHklEQVR4nGNkYGD4/58BN2BkYGD4z8CAWwnjsDABAPUsD/mRORncAAAAAElFTkSuQmCC",A.runner0=new Image,A.runner0.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAO0lEQVR4nHWOQRIAIAgC16b/f5lONoQTN5FFISSQQD2vDKTKSTOvv3pZEW5gf2rfBjfy3Hgyw4NyGuAAmrcSBuHY9doAAAAASUVORK5CYII=",A.runner1=new Image,A.runner1.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAO0lEQVR4nI2PQQ4AMAjCiv//M7vMZWExWW8iRITAYIN7rjQk6lSIMlig6qW2OQOTePS6S2k4+fD1RZsWcB0X/RDqfJEAAAAASUVORK5CYII=",A.runner10=new Image,A.runner10.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOUlEQVR4nGNgQAf/oRAKmDAUoAFGFJ0IUbg4E1ySEU0xVAMLDnPRTEDWjWYdpiPRFWPoQnYsAwMDAJG7EganEQbjAAAAAElFTkSuQmCC",A.runner11=new Image,A.runner11.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOklEQVR4nIWPMQ4AMAgCwf//mS7EqLUpbnhEAabkseIChpip7hKCQDByScMjsJoVjvYUHyfXJt8Whg5kJBf9cd/UdAAAAABJRU5ErkJggg==",A.runner12=new Image,A.runner12.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOUlEQVR4nGNgQAf/oRAKmDAUoAFGFJ0IUbg4E1ySEU0xVAMLDnPRTEDWjWYdpiPRFWPoQnYsAwMDAJG7EganEQbjAAAAAElFTkSuQmCC",A.runner13=new Image,A.runner13.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAKElEQVR4nGNgQAf/oRAKmDAU4AVoulFNQJPAVMDIwEiWNSyErCDoSAC37xP5EistNAAAAABJRU5ErkJggg==",A.runner14=new Image,A.runner14.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAKklEQVR4nGNggIH/UIgGmNAF8AMspmA3AUkRdgWMDIxEGY/dBBwKcUoCACT0FfUlTjYPAAAAAElFTkSuQmCC",A.runner15=new Image,A.runner15.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOUlEQVR4nGNggIH/UIgGmNAF0AEjCg/ZBEaIHBNW4xkZGGF8JrgAI5ppGG5AdyCKFWiCuAHMFCTTAMlNEgbln2qnAAAAAElFTkSuQmCC",A.runner16=new Image,A.runner16.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOElEQVR4nHWPMRIAIAjDEv//Z11UFLRslLQHLPU5SS0vsty0WBLESDhNA/QiHkcW81VV6PLFxwQY7BoV/hMzcWIAAAAASUVORK5CYII=",A.runner17=new Image,A.runner17.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOUlEQVR4nGNggIH/UIgGmNAF0AEjCg/ZBEaIHBNW4xkZGGF8JrgAI5ppGG5AdyCKFWiCuAHMFCTTAMlNEgbln2qnAAAAAElFTkSuQmCC",A.runner18=new Image,A.runner18.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANElEQVR4nGNgYGBgYPjP8B9Ow9hQwMRAAKAqYGRghLOhJmEI4NSAyw2oklhMIuhI3CZBAQCdChP4vSGrXwAAAABJRU5ErkJggg==",A.runner19=new Image,A.runner19.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANElEQVR4nGNgQAb/oRDGZmBgYGIgAJiQVTMwMjCiK2BEUYAqg6EY1Q1YAZoDiXIkdhOQAACdEhP4rDb2YwAAAABJRU5ErkJggg==",A.runner2=new Image,A.runner2.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAO0lEQVR4nHWOQRIAIAgC16b/f5lONoQTN5FFISSQQD2vDKTKSTOvv3pZEW5gf2rfBjfy3Hgyw4NyGuAAmrcSBuHY9doAAAAASUVORK5CYII=",A.runner3=new Image,A.runner3.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAL0lEQVR4nGNgQAP/GRj+/2dg+A/jM6ErwAvQdaOYgC6BoYCRgYGRLGtYCFlB0JEAweYT+WuIW1QAAAAASUVORK5CYII=",A.runner4=new Image,A.runner4.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAMUlEQVR4nGNggIL/DAz//zMw/GdAA0zoAngBNlOwmoCsCKsCRgYGRqKMx2oCLoU4JQEv6hX1qbmUGQAAAABJRU5ErkJggg==",A.runner5=new Image,A.runner5.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOklEQVR4nHWOQQ4AIAzCyv7/Z7y4ZKL2Bks6YGOwwQSVRaIZpkH7Vi+9QJ2rC4Xt2pADjxdZfmnLtC3SShIGve/gagAAAABJRU5ErkJggg==",A.runner6=new Image,A.runner6.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOUlEQVR4nHWPSRIAMAjCQv//Z3rpim2ORnCEgcEGE7QcJJppgbJBoNVwSt3BzWtJKV+nSrp88ZMAHfcUFf6CTDmIAAAAAElFTkSuQmCC",A.runner7=new Image,A.runner7.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAOklEQVR4nHWOQQ4AIAzCyv7/Z7y4ZKL2Bks6YGOwwQSVRaIZpkH7Vi+9QJ2rC4Xt2pADjxdZfmnLtC3SShIGve/gagAAAABJRU5ErkJggg==",A.runner8=new Image,A.runner8.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANUlEQVR4nGNgYGBg+M/A8B9Gw9gwwMRAAKAoYGRgYISxYSZhCODSAFeETSGKCSQ7EqdJMAAApwIT+MqTTdkAAAAASUVORK5CYII=",A.runner9=new Image,A.runner9.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAANklEQVR4nI2OQQoAIAzDsv3/z/Uk1DrQnAYLJWAIJNC+AZoH7XZBpVAuxOOSj4aRDPyKHBecBacKE/jH+GM+AAAAAElFTkSuQmCC",A.space=new Image,A.space.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAFUlEQVR4nGNkYGD4z4AHMOGTHD4KAAxTAQ8VzYiVAAAAAElFTkSuQmCC",A.wall=new Image,A.wall.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAQUlEQVR4nHWPUQoAIAhDN+n+V14/tmKVIIJzTyUE4Qx27W5dojqZA9wuEwiUkZ8o4/RQtQjHzryp7MyhNo5E5psTfxYQD4EjUs8AAAAASUVORK5CYII=",A.water=new Image,A.water.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAALUlEQVR4nGNkYGD4z4AHsCCYMHWMKHwmfJIMDIwMjAwM//FawUiEG/DKU8EEAJ+mCwvjTIgFAAAAAElFTkSuQmCC",A.wateru=new Image,A.wateru.src=e+"iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGElEQVR4nGNkYGD4z4AHsBCQZ2AcFiYAAI+QCA1Eth8IAAAAAElFTkSuQmCC",A},klad.key={pressed:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,FIRE_LEFT:81,FIRE_RIGHT:87,isDown:function(A){"use strict";return this.pressed[A]},onKeydown:function(A){"use strict";this.pressed[A.keyCode]=!0},onKeyup:function(A){"use strict";delete this.pressed[A.keyCode]},reset:function(){"use strict";this.pressed={}}},window.addEventListener("keyup",function(A){"use strict";klad.key.onKeyup(A)},!1),window.addEventListener("keydown",function(A){"use strict";klad.key.onKeydown(A)},!1),window.onblur=function(){"use strict";klad.key.reset()},klad.createMaze=function(){"use strict";var A,e,n,r={CELL_WIDTH:8,CELL_HEIGHT:8,SPACE:0,BRICK:1,LADDER:2,BRIDGE:3,WALL:4,DOOR:5,KLAD:6,WATER:7,KEY:8,DOOR_OPENED:9,BULLET:34,UNDERWATER:35,BRICK0:36,BRICK1:37,BRICK2:38,BRICKL0:39,BRICKL1:40,BRICKR0:41,BRICKR1:42},t=32,i=22,g=180,s=!1,E=[];for(A=new Array(t),e=0;t>e;e+=1)for(A[e]=new Array(i),n=0;i>n;n+=1)A[e][n]=0;return r.loadLevel=function(r,g){for(n=0;i>n;n+=1)for(e=0;t>e;e+=1)A[e][n]=parseInt(g[r].bitmap.charAt(e+n*t),10);s=!1,E=[]},r.render=function(r,g){var E,o;for(n=0;i>n;n+=1)for(e=0;t>e;e+=1){switch(E=A[e][n],E===this.WATER&&n>0&&(A[e][n-1]===this.WATER||A[e][n-1]===this.WALL)&&(E=this.UNDERWATER),E!==this.KEY||s||(E=this.KLAD),E){case this.SPACE:o=g.space;break;case this.BRICK:o=g.brick;break;case this.LADDER:o=g.lestnica;break;case this.BRIDGE:o=g.most;break;case this.WALL:o=g.wall;break;case this.DOOR:o=g.door;break;case this.KLAD:o=g.klad;break;case this.WATER:o=g.water;break;case this.KEY:o=g.key;break;case this.DOOR_OPENED:o=g.opendoor;break;case this.UNDERWATER:o=g.wateru;break;case this.BRICK0:o=g.brick0;break;case this.BRICK1:o=g.brick1;break;case this.BRICK2:o=g.brick2;break;case this.BRICKL0:o=g.brickL0;break;case this.BRICKL1:o=g.brickL1;break;case this.BRICKR0:o=g.brickR0;break;case this.BRICKR1:o=g.brickR1}o&&r.drawImage(o,e*this.CELL_WIDTH,n*this.CELL_HEIGHT)}},r.setKeyFound=function(){s=!0},r.get=function(e,n){return A[e][n]},r.set=function(e,n,r){A[e][n]=r},r.wallRegen=function(){var e,n;for(e=E.length-1;e>=0;e-=1){switch(E[e].timer+=1,n=-1,E[e].timer){case g:n=this.BRICK0;break;case 2*g:n=this.BRICK1;break;case 3*g:n=this.BRICK2;break;case 4*g:n=this.BRICK}n>=0&&(A[E[e].x][E[e].y]=n),E[e].timer>=4*g&&E.splice(e,1)}},r.shot=function(e,n,r){var i,g;return 0>e||e>=t?!1:(g=A[e][n],this.antiBullet(g)?!1:this.isBrick(g)?(i=this.SPACE,r?g===this.BRICK?i=this.BRICKL0:(g===this.BRICKL0||g===this.BRICKR0)&&(i=this.BRICKL1):g===this.BRICK?i=this.BRICKR0:(g===this.BRICKL0||g===this.BRICKR0)&&(i=this.BRICKR1),A[e][n]=i,void(i===this.SPACE&&E.push({x:e,y:n,timer:0}))):!0)},r.isSpace=function(A){return A===this.SPACE||A===this.BRICK0||A===this.BRICK1||A===this.BRICK2},r.isBrick=function(A){return A===this.BRICK||A===this.BRICKL0||A===this.BRICKL1||A===this.BRICKR0||A===this.BRICKR1},r.antiBullet=function(A){return A===this.WALL||A===this.WATER||A===this.UNDERWATER||A===this.DOOR},r},klad.levels=[{bitmap:"44041111111111111111111111112144440400000000000000000000000020444404211002110000000000111000204444042110021131211111111113112144440421131200002000000000500020444404200002000620000000211111104444042000020001111111112000002044440420000200000000000111200020444404201112113110080000002333204444042000020000111111110020002044440420000200000006060000200020444404200111113112110111102000204444042000000000020000000020002044440413311200000200011100200210444404000002000002113111311002004444046000111111320000000000020644440411000000000200000001210211444404600012111111110110002002014444041110020000000000001121110144440400000211111111010000200061444400000002000000000000002001114444444444447777777777777744444444",player:{x:2,y:0},aliens:[{x:16,y:2},{x:21,y:2}],key:{x:20,y:20}},{bitmap:"44111111111111111111111011211144440000000000000060000000002000444400021111333111111333111110004444000200000000000000000000000044448002000000000000000000000000444412110001211113333311111200004444020000002000000000000002000044440200000020000000000000020000444402060000200006000000006200004444020121111000211112100011120044440200200000002000020000000200444402002000000020000200000002004444020020000000200002000000020044441111100021111000021111200200444400000000200000000200002002004444000000002000000002000020020044440006000020000600020000200200444400011211111001111110001111004444000002000000000000000000000044440000020000000000000000000000444400000200000000000000000000004444444444477777777777777777777744",player:{x:2,y:20},aliens:[{x:23,y:0}],key:{x:20,y:20}},{bitmap:"44000000101000001111111111112144440000000000000000000060105020444400021001110011111111101211114444063200000002000000020002121644440102101111110102111213110211444401020000000000020001000002104444010200031111313111112333101044440102132000000100000020000000444401000023111101021111131311114444013310200601010200000000000044440100102111010004331113131120444401601020010111047774061011204444011010200000010444440110002044440110474121310000000001131120444401104441210111311110000011204444011600002000000000133110112044440111012111311111100000001120444401110020000006000042310000204444011111211133111133420113102044440000002000000000006201101020444400000024777777777744777744444444444444447777777777777777444444",player:{x:2,y:20},aliens:[{x:15,y:0}],key:{x:20,y:20}},{bitmap:"44002000000000000000000000000044440020000000006000333333333320444400020000000033200000000000204444011020000000002006333200002044440110020000000200000000200020444400500020000020000233332000204444021333320000200002000000002044440200000020000200023333206020444402600000020000200000002000204444021000000020002002333320602044440206666660022002020000000020444402013333306202020233332060204444026066666033000200000020002044440010133333332020133333204320444400000000000002000000000000204444000233333332000233333333332044440002000000003330000000000000444400023333332000002333333333204444000000000003333300000000002044440002333332000000023333333300444400020000003333333000000000004444111177777777777777777777777744",player:{x:2,y:20},aliens:[{x:3,y:2}],key:{x:20,y:20}},{bitmap:"44000000000000000000000000004244440000000000000000000000000042444406222226222226222226222226524444020020020020020020020020024444440200200200200200200200200204444402226222226222226222226222044444020020020020020020020020020444440200200200200200200200200204444406222226222226222226222226044444020020020020020020020020020444440200200200200200200200200204444402226222226222226222226222044444020020020020020020020020020444440200200200200200200200200204444406222226222226222226222226044444020020020020020020020020020444440200200200200200200200200204444402226222226222226222226222044444020020020020020020020020020444440200200200200200200200200204444444774774774774774774774774744444447777777777777777777777777444",player:{x:4,y:4},aliens:[{x:12,y:12}],key:{x:20,y:20}}],klad.createBullet=function(A){"use strict";var e,n=-1,r=1,t={x:0,y:0},i=!1;return{getPos:function(){return t},render:function(e,n){i&&e.drawImage(n.bullet,t.x*A.CELL_WIDTH,t.y*A.CELL_HEIGHT)},shot:function(A,n,r){i||(t.x=Math.floor((A+2)/4),t.y=Math.floor((n+2)/4),e=r,i=!0)},shotLeft:function(A){this.shot(A.x,A.y,n)},shotRight:function(A){this.shot(A.x,A.y,r)},move:function(){i&&(e===r?t.x+=1:t.x-=1,i=A.shot(t.x,t.y,e===r))}}},klad.createHuman=function(A,e){"use strict";var n,r={},t={x:4,y:20},i={x:4,y:4},g=!1,s=1,E=2,o=3,a=4,R=5,I=300,u=!1,l=0,C=!1;return r.kill=function(){g=!1},r.isDead=function(){return!g},r.getDistance=function(A){return Math.floor(Math.sqrt(Math.pow(t.x-A.getPos().x,2)+Math.pow(t.y-A.getPos().y,2)))},r.isKeyFound=function(){return u},r.caught=function(A){return this.getDistance(A)<3},r.resetKeyFound=function(){u=!1},r.freeSquare=function(n,r){var i=e.get(n,r),g=e.isSpace(i)||i===e.LADDER||i===e.KLAD||i===e.KEY||i===e.DOOR_OPENED||i===e.BRIDGE;return A||(i===e.KLAD&&e.set(n,r,e.SPACE),i===e.KEY&&(u=!0,e.setKeyFound()),i===e.DOOR&&u&&(e.set(n,r,e.DOOR_OPENED),g=!0),0>r&&(C=!0)),i===e.WATER&&t.y%4===2&&this.kill(),g},r.getPos=function(){return t},r.moveLeft=function(){return t.x%4!==0||this.freeSquare(Math.floor(t.x/4)-1,Math.floor((t.y+2)/4))?t.y%4!==0?t.y%4>1?this.moveDown():this.moveUp():(t.x-=1,n=s,!0):!1},r.moveRight=function(){return t.x%4!==0||this.freeSquare(Math.floor(t.x/4)+1,Math.floor((t.y+2)/4))?t.y%4!==0?t.y%4>1?this.moveDown():this.moveUp():(t.x+=1,n=E,!0):!1},r.moveUp=function(){var r=Math.floor((t.x+2)/4),i=Math.floor(t.y/4);return t.y%4!==0||this.freeSquare(r,i-1)&&e.get(r,i)===e.LADDER?t.x%4!==0?(A||(t.x%4>1?this.moveRight():this.moveLeft()),!1):(t.y-=1,n=o,!0):!1},r.moveDown=function(){return t.y%4!==0||this.freeSquare(Math.floor((t.x+2)/4),Math.floor(t.y/4)+1)&&e.get(Math.floor((t.x+2)/4),Math.floor(t.y/4)+1)!==e.BRIDGE?t.x%4!==0?(A||(t.x%4>1?this.moveRight():this.moveLeft()),!1):(t.y+=1,n=a,!0):!1},r.render=function(r,i){var g,R=8,I=[i.runner0,i.runner1,i.runner2,i.runner3,i.runner4,i.runner5,i.runner6,i.runner7,i.runner8,i.runner9,i.runner10,i.runner11,i.runner12,i.runner13,i.runner14,i.runner15,i.runner16,i.runner17,i.runner18,i.runner19];(n===s||n===E)&&(R=t.x%4),n===s&&(R+=4),(n===o||n===a)&&(R=t.y%2+8),A&&(R+=10),g=I[R],r.drawImage(g,t.x*(e.CELL_WIDTH/4),t.y*(e.CELL_HEIGHT/4))},r.respawn=function(A,e){i.x=A,i.y=e,t.x=4*i.x,t.y=4*i.y,g=!0,l=0},r.freeFly=function(){var A,r,i=Math.floor((t.x+2)/4),g=Math.floor(t.y/4);return this.freeSquare(i,g+1),e.get(i,g)===e.LADDER?!1:(A=e.get(i,g+1),(r=e.isSpace(A)||A===e.WATER||A===e.BRIDGE&&n===R)?(t.x%4!==0?t.x%4>1?this.moveRight():this.moveLeft():t.y+=1,n=R,!0):!1)},r.isFinished=function(){return C},r.resetFinished=function(){C=!1},r.moveToHuman=function(A){var e=!1,n=!1,r=!1,t=!1;A.getPos().x<this.getPos().x&&(e=!0),A.getPos().x>this.getPos().x&&(n=!0),A.getPos().y>this.getPos().y&&(t=!0),A.getPos().y<this.getPos().y&&(r=!0),this.move(e,n,r,t)},r.move=function(n,r,s,E){if(A&&!g)return l+=1,l>=I&&this.respawn(i.x,i.y),!1;if(this.freeFly())return!1;var o=!1;return n&&this.moveLeft()&&(o=!0),r&&this.moveRight()&&(o=!0),o||(s&&this.moveUp(),E&&this.moveDown()),e.get(Math.floor((t.x+2)/4),Math.floor((t.y+2)/4))===e.BRICK&&this.kill(),!0},r},document.addEventListener("DOMContentLoaded",function(){"use strict";function A(){C.loadLevel(R,klad.levels),k=klad.createBullet(C),c.resetFinished(),c.respawn(klad.levels[R].player.x,klad.levels[R].player.y),c.resetKeyFound(),D.respawn(klad.levels[R].aliens[0].x,klad.levels[R].aliens[0].y),h=null,klad.levels[R].aliens[1]&&(h=klad.createHuman(!0,C),h.respawn(klad.levels[R].aliens[1].x,klad.levels[R].aliens[1].y))}function e(){return 60>u?void(u+=1):(a=E,void A())}function n(){return 30>u?void(u+=1):(a=E,R+=1,R>=5&&(R=0),void A())}function r(){if(u+=1,!(2>u)){u=0,l+=1,l>2?l=0:(D.moveToHuman(c),h&&h.moveToHuman(c));var A=c.caught(D);return h&&h.caught(c)&&(A=!0),A&&(c.kill(),D.kill(),h&&h.kill()),k.move(),C.wallRegen(),c.move(klad.key.isDown(klad.key.LEFT),klad.key.isDown(klad.key.RIGHT),klad.key.isDown(klad.key.UP),klad.key.isDown(klad.key.DOWN)),klad.key.isDown(klad.key.FIRE_LEFT)&&k.shotLeft(c.getPos()),klad.key.isDown(klad.key.FIRE_RIGHT)&&k.shotRight(c.getPos()),c.isFinished()?void(a=o):void(c.isDead()&&(a=s))}}function t(){switch(a){case s:e();break;case E:r();break;case o:n()}}function i(){C.render(I,w),c.render(I,w),D.render(I,w),h&&h.render(I,w),k.render(I,w)}function g(){t(),i(),requestAnimationFrame(g)}var s=1,E=2,o=3,a=E,R=0,I=document.getElementById("canvas").getContext("2d"),u=0,l=0,C=klad.createMaze(),c=klad.createHuman(!1,C),D=klad.createHuman(!0,C),h=null,k=klad.createBullet(C),w=klad.createImages();A(),requestAnimationFrame(g)});
